# encoding:utf-8# encoding:utf-8
from flask import Flask, render_template, request, redirect, url_for, session
from lxml import etree
import requests
import yagmail
# from urllib.request import urlopen


app = Flask(__name__)
app.config['SECRET_KEY'] = 'superkey'

arr = [
http://152.67.229.180/77392a78-8326-4ef4-b247-be7d1130a5b1
http://152.67.229.180/8773a853-ec8b-4602-9264-8a4692fc25a0	
http://152.67.229.180/dec30d5c-98b2-416f-b667-90b727c22b48	
http://152.67.229.180/d59d03c3-16db-4711-8318-9613b1a2463c	
http://152.67.229.180/69feed61-6929-4ce4-90e2-352e411ffa49	
http://152.67.229.180/ad0176a9-38ee-4e52-98dd-fccbda98c767	
http://152.67.229.180/9af49bbf-78b7-45dd-9d1f-452ca62bf63a	
http://152.67.229.180/57b3c9b1-116a-4ad7-bd06-3f5a437bcb2d	
http://152.67.229.180/a401046b-899d-400e-8c1a-7e7aedc735b5	
http://152.67.229.180/ebead779-22b0-412d-bc3c-d5e802b09dfb
http://152.67.229.180/5fce853f-58d1-4d88-8029-3cad48f1abc2
http://152.67.229.180/1938573b-55be-4274-a2b0-9e20451f8ba6
http://152.67.229.180/3058080c-8708-44c6-8050-33dc8c9e247c
http://152.67.229.180/907a43ea-3cff-444c-9141-49198fadee85
http://152.67.229.180/7542df7b-72cd-476a-9863-a57a0158d9b5
http://152.67.229.180/f9101369-86a2-4260-8054-00a577dbb87b
http://152.67.229.180/041891ec-b764-4f45-95b5-e3f1f7c177a0
http://152.67.229.180/1ffde9bd-f4c3-496e-95bf-cf460f7c5869
http://152.67.229.180/9c9b63fd-94d1-4144-8fcc-a6ef668c1a4d
http://152.67.229.180/1e57e671-5388-403e-9298-89a5a50d1911
http://152.67.229.180/2E7E16C2-8769-4D9E-BBFF-D5492A6E5592
http://152.67.229.180/1D7FB452-A0D5-498A-915C-0FB3515AE8AE
http://152.67.229.180/BBD8CDAB-8435-4594-B02E-32EA09241328
http://152.67.229.180/75A152FC-7A71-4BEC-9D6B-54BAD2B11979
http://152.67.229.180/E3D75C34-95BF-4735-999E-4E865987DF57
http://152.67.229.180/D769A05D-9249-41A4-A9A1-36573561ACA7
http://152.67.229.180/99EB5D7C-FA22-4CD8-953D-E41B2ADA8E54
http://152.67.229.180/9D54D9C5-7008-4A6C-8BE9-3BFC3BEF9DFD
http://152.67.229.180/D03EDC26-2D53-45E1-9491-258DF2FBBD62
http://152.67.229.180/185C8AAC-F7A0-46B3-BB5E-E642FD9E9E47
http://152.67.229.180/916D8DE3-5520-43FA-8F68-FA09244C6132
http://152.67.229.180/251FABB2-6EA4-4357-95DD-32163E08D4B7
http://152.67.229.180/FA4E8CDD-2085-414C-8BC6-CB44AE849895
http://152.67.229.180/A12646E2-5DE9-4407-A54D-58A312240512
http://152.67.229.180/D151475F-FBCA-4267-B4AE-33C9A675C093
http://152.67.229.180/13ED5199-52A8-408D-ABF5-EE5EA6693411
http://152.67.229.180/D4DD6945-B9AE-4F5E-A4AB-05D1BB9E8130
http://152.67.229.180/7DC8446B-4C9D-4472-BD50-BC9DF952BF64
http://152.67.229.180/3E2FE8F9-7FC8-435D-BC6E-F6F8C662438C
http://152.67.229.180/E6ACB89D-FE03-4867-AD23-FECBDF310C45
http://152.67.229.180/973F2DEA-DDB4-4AA3-A7A1-34C9FB9CD82E
http://152.67.229.180/14CAE04A-B103-4DF1-BAAB-DD68C1EBFE15
http://152.67.229.180/ABDF31D2-4E01-4F20-802F-8F443F7D9FE2
http://152.67.229.180/6F39E804-8A2F-493E-BCD3-B1F6882F9198
http://152.67.229.180/EBC1ADCF-7A7C-43D1-84F8-0B38B4034198
http://152.67.229.180/93089E2E-2866-4ED9-B2D5-8D18384C7AF1
http://152.67.229.180/F4AA4477-2ACB-44CB-A513-D72EC1C5E23F
http://152.67.229.180/C13D1B58-BD49-46D5-9043-C9F0EEC09BFF
http://152.67.229.180/0DB38043-95D4-4CB5-A76E-4B85BBA9CAD9
http://152.67.229.180/5EDE7616-06FD-4842-BA85-088B2B695DB5
http://152.67.229.180/65255918-17AB-4584-9730-3A126680A61C
http://152.67.229.180/2A4285E5-C0B1-4608-AD92-23BE85A329F1
http://152.67.229.180/599569AA-1678-4DA3-85A4-6CC8E9389BB3
http://152.67.229.180/05EF11D2-663A-4CB1-A495-EDB6AD2444A2
http://152.67.229.180/7CA5D0A9-5A7A-475A-A8C2-8A7BC879E8E0
http://152.67.229.180/0AE07329-8B1A-4C66-AE6A-69A9B332CB2D
http://152.67.229.180/D7358D4E-9810-49E0-AD64-98D69613B5FC
http://152.67.229.180/A5A7E8BF-39C8-4B79-815A-6C12DEA7750E
http://152.67.229.180/A9DCBC66-8775-435E-8156-75BA2D5B74B7
http://152.67.229.180/63CB97D8-4AC2-4EFB-AC1B-5764D9D737C2
http://152.67.229.180/19E4C777-5258-49FE-A6B9-BA2F16CD1135
http://152.67.229.180/61615A59-B2A9-4B4B-BED8-E06AC1D8FC3D
http://152.67.229.180/020740F0-1CDB-4FAE-A29E-500C47A39D0D
http://152.67.229.180/4B5A87A6-545E-49D4-B597-F4801320AB33
http://152.67.229.180/CF11866A-FE24-42AF-9F9B-E948C6C5C5B0
http://152.67.229.180/B4647E9B-C046-43D2-9503-CA0BB47826D6
http://152.67.229.180/F32C23AC-8CAF-45CA-9522-45BBDB2A3FDE
http://152.67.229.180/80A6CD1A-D526-41DA-B32D-99EA53AEBF2B
http://152.67.229.180/D543AF27-ECA8-4798-B919-A660F571D6FC
http://152.67.229.180/3B26DE8F-917E-4630-A583-B87306B5A479
http://152.67.229.180/10F523F8-DB30-44F6-9AB2-362FE8CA7D45
http://152.67.229.180/320CDE3C-6AB8-4A73-BE0F-7F717E8FCBEA
http://152.67.229.180/BA26D4AD-BB41-4541-8615-F9A7AB41E80F
http://152.67.229.180/1E632564-E85B-4220-A050-DAEE982C030E
http://152.67.229.180/357C1F26-DDC0-465B-B004-770AA6080A9B
http://152.67.229.180/2F9FEE96-ADBE-4A7A-AA3A-77A83E13BDA3
http://152.67.229.180/28BBEDF7-6F7E-40AF-AF68-F382AE5A8584
http://152.67.229.180/C7E69611-EB80-463A-9255-0AD2DE6C82FE
http://152.67.229.180/2CA42466-33C4-4D78-9183-312236DB4649
http://152.67.229.180/D1A02364-5FCC-44F1-8D30-CC1CED9CBCB6
http://152.67.229.180/1F00BCDC-42A3-434E-AFA6-F6FAD7ED25AF
http://152.67.229.180/0309464E-0DA5-465F-842C-A30BC1A86330
http://152.67.229.180/DA28DE6A-9485-465B-8134-BA14E5D83D25
http://152.67.229.180/EE843267-3F7D-4E38-9914-952E35C32A6C
http://152.67.229.180/FD62D843-8463-4DA3-B600-208121E0A6B9
http://152.67.229.180/76FABD66-1BF7-4435-9DCD-D35132E87ABB
http://152.67.229.180/BB92A3D5-332E-4B6A-9DF5-B7A252FE5AE9
http://152.67.229.180/E8542159-E9FD-4212-AED2-C275AF7049CC
http://152.67.229.180/79B77743-B039-4967-B5A2-4980EBA549B7
http://152.67.229.180/E26C7580-3916-41EE-B643-3010862CE868
http://152.67.229.180/A69990F5-887F-4E9F-B849-0E19FA3FCB47
http://152.67.229.180/D0527303-5A11-4B69-8204-318406438ECF
http://152.67.229.180/F5C17519-BED9-4854-B392-2BCEBAB5DF3C
http://152.67.229.180/B96E6F40-0D9E-44E8-8D42-3B8D737B023A
http://152.67.229.180/E33C6B4E-7CED-49BF-A194-F77819AA226C
http://152.67.229.180/17D30F1B-8D16-4E83-8D9A-A064691535FE
http://152.67.229.180/D2B43CF8-1961-46D1-8D77-FE1C726CE596
http://152.67.229.180/E58E39CE-81F2-417F-B680-3E857BECE717
http://152.67.229.180/D746032C-45BC-4C3F-956E-A8F43E9B109B
http://152.67.229.180/1D9D0100-26F3-448E-B3A2-D35517554321
http://152.67.229.180/F765DD09-418D-492C-BF9F-F82AB32557C0
http://152.67.229.180/9C50A7D7-3140-4441-B927-DB6A9DD2F80F
http://152.67.229.180/8F8AEE8C-B876-4D24-99CE-DA40D882AAEB
http://152.67.229.180/25BF341E-CE93-4806-A8D1-47E0F3DAB8F2
http://152.67.229.180/A5104AB2-6650-4B36-9D66-670C87EB46B6
http://152.67.229.180/C454E605-4197-4364-8DF8-AE2B6D55B0D3
http://152.67.229.180/FA90608B-D90E-4DF3-A781-85B2DE8E0B22
http://152.67.229.180/77EE1372-AE00-479B-9D60-25E0BC99DC77
http://152.67.229.180/5AE95CED-DDD7-44B8-847A-096523D2DF1E
http://152.67.229.180/83122903-987C-4100-B1FF-A364D29936B9
http://152.67.229.180/DDE27101-C893-40B5-A57F-F08BA886E266
http://152.67.229.180/6165BE72-0B9E-41CF-AAA2-3DA093C788EB
http://152.67.229.180/D12702D6-EC8D-43CA-B2FD-44B601FB28FE
http://152.67.229.180/557B10F2-B852-4A7D-9E70-8D7AC1EE176C
http://152.67.229.180/A445B3A7-4220-47E9-84D0-92DFAAB65CCB
http://152.67.229.180/582977BE-DD22-42F6-8AC0-8552E9953BA6
http://152.67.229.180/A9AACFCD-E8B8-4E6D-9CBD-2A52325005D3
http://152.67.229.180/BD2162F5-7556-4063-ACA4-4CBD17CF33E1
http://152.67.229.180/FD430EF4-C954-4E18-967E-CB6E3A12C621
http://152.67.229.180/8BD48ADE-8548-4BE5-80BE-0130577594BC


i = 0
cha = arr[i]

yag = yagmail.SMTP(user="pc576063015@gmail.com",password="kcqhxevrfggvbrlo",host ='smtp.gmail.com')



@app.route('/<string:key>', methods =['GET','POST'])
def classNeeds(key):

    global cha, i, arr

    if key != cha:
        return render_template('finish.html')


    elif key == cha:

        if request.method == 'POST':
            print("if = post:", i)
            url = request.form.get('url')
            email = request.form.get('email')
            i = i+1
            cha = arr[i]
            answer_list = info(url)
            # if users did not input their email
            if not email:
                print("if = not email:", i)

                 # go the html page which display all images
                return render_template('check.html', links=answer_list)
            # is users provides their email address
            else:
                try:
                    contents = answer_list
                    yag.send(email,'subject',contents)
                  #  return render_template('check.html', links=answer_list)
                except:
                    pass
                finally:
                    return render_template('check.html', links=answer_list)
        else:
            return render_template('index.html')

    

#spider


def info(input_url):
    
    
    headers = {"User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:66.0) Gecko/20100101 Firefox/66.0", "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8", "Accept-Language": "en-US,en;q=0.5", "Accept-Encoding": "gzip, deflate", "DNT": "1", "Connection": "close", "Upgrade-Insecure-Requests": "1",
    "Cookie": "C=0; O=0; V=9224ba6bcdc5a300bd6db48e5bc771215ece08fb3d4867.89537718; optimizelyEndUserId=oeu1590561020522r0.763449736911042; _pxvid=89aa5a55-9fe3-11ea-930d-0242ac12000a; _scid=44ef76c7-1e91-42c2-b3b6-b2d7db2f3aae; _ga=GA1.2.1919906297.1590561023; _fbp=fb.1.1590561022733.898065526; s_ecid=MCMID%7C15607790857395283912784252851908880330; _gcl_au=1.1.93383985.1590561023; aam_tnt=aam%3D2053348; aam_uuid=15602479557138383332787088560419961840; LPVID=JhOTkxZDY4ZTM5OWNhMmRl; __gads=ID=255ba5d4de2acc77:T=1590566955:S=ALNI_MZ8hkyO6gE-WrmE5keRdtDObOaNzg; WRUID=2800628045955558; _gac_UA-499838-3=1.1592862491.EAIaIQobChMI2-i3lbOW6gIVpx-tBh35Ewc0EAAYASAAEgINJfD_BwE; _gcl_aw=GCL.1592862491.EAIaIQobChMI2-i3lbOW6gIVpx-tBh35Ewc0EAAYASAAEgINJfD_BwE; _gcl_dc=GCL.1592862491.EAIaIQobChMI2-i3lbOW6gIVpx-tBh35Ewc0EAAYASAAEgINJfD_BwE; _cs_c=1; adobeujs-optin=%7B%22aam%22%3Atrue%2C%22adcloud%22%3Atrue%2C%22aa%22%3Atrue%2C%22campaign%22%3Atrue%2C%22ecid%22%3Atrue%2C%22livefyre%22%3Atrue%2C%22target%22%3Atrue%2C%22videoaa%22%3Atrue%7D; gid=1564607; gidr=MA; sourceTracking=431788; U=a1d4302c6e6705518af7072e0ebd7713; _fby_site_=1%7Cchegg.com%7C1596603120%7C1596603120%7C1596603120%7C1596606518%7C1%7C7%7C7; capp_promo_modal_shown=true; aamsc=aam%3D2053348%2Caam%3D2756555%2Caam%3D5674360; _CT_RS_=Recording; _sctr=1|1598684400000; user_geo_location=%7B%22country_iso_code%22%3A%22US%22%2C%22country_name%22%3A%22United+States%22%2C%22region%22%3A%22CA%22%2C%22region_full%22%3A%22California%22%2C%22city_name%22%3A%22Redwood+City%22%2C%22postal_code%22%3A%2294061%22%2C%22locale%22%3A%7B%22localeCode%22%3A%5B%22en-US%22%5D%7D%7D; AMCVS_3FE7CBC1556605A77F000101%40AdobeOrg=1; AMCV_3FE7CBC1556605A77F000101%40AdobeOrg=-408604571%7CMCIDTS%7C18507%7CMCMID%7C15607790857395283912784252851908880330%7CMCAAMLH-1599552735%7C9%7CMCAAMB-1599552735%7CRKhpRz8krg2tLO6pguXWp5olkAcUniQYPHaMWWgdJ3xzPWQmdj0y%7CMCOPTOUT-1598955135s%7CNONE%7CMCAID%7CNONE%7CvVersion%7C4.6.0%7CMCCIDH%7C-1513874356; BIBSESSID=0f1fa762-ae56-43d7-ad6b-feffb84ca53e; userRole=not_logged_in; _gid=GA1.2.1990993081.1598947938; _gat=1; LPSID-51961742=vvEmB6glQdG6uAT8St5tQg; exp=A311B%7CA579C%7CA803B%7CP569C%7CP570C%7CP571C%7CA560B%7CA253A%7CA294B%7CA185B%7CC020A%7CA756C%7CA384B%7CA594A%7CA247A; expkey=2D8D03A7B51BAE8C04A86BB503E0E2FE; PHPSESSID=7rpag1v8380pr9gdv3g9atqe9o; CSessionID=d56f1e52-0f4f-4598-a29b-d4d9be119106; OptanonConsent=isIABGlobal=false&datestamp=Tue+Sep+01+2020+01%3A12%3A32+GMT-0700+(Pacific+Daylight+Time)&version=6.4.0&landingPath=NotLandingPage&groups=snc%3A1%2Cprf%3A1%2Cfnc%3A1%2Ctrg%3A1%2CSPD_BG%3A1&AwaitingReconsent=false&hosts=&consentId=6ff49fd0-8840-42be-9288-fa3fb00caa4f&interactionCount=0; _px=3CG12a54XlXghOG+2ADTmaQGx7FqKdrzQOjmkJICDF9tRUK90S7Q3t2CWt/5UyjaaNquB43BGhCQiyC7YazkEw==:1000:Fx7FpsYrsqLR3viX/VDlsgEM81n174ChqzBvpZKq+OJjNOMQO9GHzWf/VDRQgTfi0MLIkDimLymnbDhWEVv079z6O9r0jwWjYY7mM25+qpR5r2llKacQbzc1USDqrd8Qo6WqRqIoygUfWth6aA3rfg4Ha9Rs+hBa2V5X/wzWT0ls1+n4sp1nEV4s2qrZBX/QV2WT2f3wcxKR5BAaSyy8fyazd8ActX7xGOOlXUYSo+HtJDFOiK1ZfVk7Gu1go1jTDLx4Ejo3N35pqob+QQoRcw==; _px3=06fb3bdc0e2a6ed3afbd25c415756023e5562d90d65bade8e7e119658b28d6a8:3CG12a54XlXghOG+2ADTmaQGx7FqKdrzQOjmkJICDF9tRUK90S7Q3t2CWt/5UyjaaNquB43BGhCQiyC7YazkEw==:1000:ZbbywhvituEhN6Nhb8enx8oHDzP5KM1RemP97h1/bxbGfu2qIQthdf0CDjWoUBPkLSYVM/JcfmYoZcaTPpn/viLGz2vVIg9gzR9BYjUwbcWKZpPx4u4Gj3bBJmJZymUXF5i/1MIZiK0fzqexPRC10w6OsnBleSfIZx+gScTfr+U=; _uetsid=a0fc4cb47871cf579a12b5241f5d78dc; _uetvid=b078e0a56ae1fd84b7431ee18765e85d; _cs_cvars=%7B%221%22%3A%5B%22Page%20Name%22%2C%22Auth%20page%22%5D%2C%222%22%3A%5B%22Experience%22%2C%22desktop%22%5D%2C%223%22%3A%5B%22Page%20Type%22%2C%22core%22%5D%2C%224%22%3A%5B%22Auth%20Status%22%2C%22Logged%20Out%22%5D%7D; _cs_id=d23e2cca-ef01-a10e-ea88-c6b105f632ca.1594324224.119.1598947953.1598947937.1.1628488224440.Lax.0; _cs_s=3.1; __CT_Data=gpv=614&ckp=tld&dm=chegg.com&apv_79_www33=622&cpv_79_www33=622&rpv_79_www33=112; s_pers=%20buFirstVisit%3Dcore%252Ctb%252Ccs%252Chelp%252Ctut%252Cseo%7C1754596095732%3B%20gpv_v6%3Dchegg%257Cweb%257Ccore%257Cauth%2520page%7C1598949759548%3B; s_sess=%20buVisited%3Dcore%3B%20s_cc%3Dtrue%3B%20s_ptc%3D0.12%255E%255E0.00%255E%255E0.00%255E%255E0.00%255E%255E0.15%255E%255E0.00%255E%255E1.34%255E%255E0.04%255E%255E1.89%3B%20cheggCTALink%3Dfalse%3B%20SDID%3D02A4A8AD2AFEB243-547316E4E4FBDF48%3B%20s_sq%3Dcheggincglobal%253D%252526c.%252526a.%252526activitymap.%252526page%25253Dchegg%2525257Cweb%2525257Ccore%2525257Cauth%25252520page%252526link%25253DSign%25252520in%252526region%25253DBODY%252526pageIDType%25253D1%252526.activitymap%252526.a%252526.c%252526pid%25253Dchegg%2525257Cweb%2525257Ccore%2525257Cauth%25252520page%252526pidt%25253D1%252526oid%25253DSign%25252520in%252526oidt%25253D3%252526ot%25253DSUBMIT%3B"
    }

    session = requests.Session()

    response = session.get(input_url,headers=headers)

    html = etree.HTML(response.text)

    #写成html文件来检查
    # with open('chegg1.html','w', encoding='utf-8') as fp:
    #     fp.write(response.text)

    answer_url = html.xpath('//*[@class="txt-body answer-body"]/div/p/img/@src')


    return answer_url
    
